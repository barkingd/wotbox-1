<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Workflow of Things</title>
  <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.3.3/angular.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.3/angular-route.min.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script> 
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
  <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
  <script src="script.js"></script>
  <script>
  $( function(){
    $("#accordion").accordion();
  });
  setInterval(function(){

//Get current time
var newTime = new Date();
var vIP = $('#ip').val();

//call temp $ajax
$.getJSON("http://" + vIP + ":8484/pi/sensors/temperature",
function(data){
$('#tVal').html((((data.value *9)/5) + 32).toFixed(2) + " F // " +
(data.value) + " C");

//configure workflow variables
var status = (status == true) ? true : false;
 
t = (((data.value *9)/5) + 32).toFixed(2),
hT = $('#numHigh').val(),
lT = $('#numLow').val(),
email = $('#txtEmail').val();
pNumber = $('#numPhone').val();


if((t >= hT || t <= lT) && status == false) {
  status = true;
  $.ajax({
      "url": "https://ntxdemo14.workflowcloud.com/api/v1/workflow/published/e1b8aa03-da1d-47f7-a0d4-8e011a79327b/instances?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJOV0MiLCJ3b3JrZmxvd0lkIjoiZTFiOGFhMDMtZGExZC00N2Y3LWEwZDQtOGUwMTFhNzkzMjdiIiwidGVuYW50SWQiOiJudHhkZW1vMTQiLCJpYXQiOjE0ODA5Nzk5Mzd9.gjrQ3L2e_ANaRTIOw9YtB5BzXYN6ZrMginvKipNN4Yg", 
      "method": "POST",
      "contentType": "application/json",
      "dataType": "json",
      "data": JSON.stringify({
        "startData": {
          "se_phone_number1": pNumber,
          "se_email1": email
        }
      }),
  });
}

$('#timeVal').html("Tempurature last read at: " + newTime);
});
}, 1000);
</script>
</head>

<body>
  <div>
    <div>
      <nav class="navbar navbar-inverse" role="navigation" style="padding-left:130px;">
        <ul class="nav navbar-nav">
          <li><a href="/">Home<span class="sr-only">(current)</span></a></li>
          <li><a href="/about">About us</a></li>
          <li class="active"><a href="/temp">Tempature Sensor</a></li>
          <li><a href="/motion">Motion Sensor</a></li>
          <li><a href="/tellme">Tell Me More</a></li>
        </ul>
      </nav>
    </div>
    <br/>
    <div class="jumbotron"><img src="https://www.nintex.com/-/media/images/nintex/icons/icon-cloud-md.ashx?h=150&w=150&la=en&hash=0E092FECCE626AF846AE350FFA3D36EE778C7CA5"
        style="position: absolute; padding-left: 10px;" />
      <div style="position: relative; padding-left: 170px; padding-top: 20px;">
        <h2>Current Temperature Reading</h2>
        <h2 id="tVal"></h2>
        <h4 id="timeVal"></h4>
      </div>
      <div id="accordion">
        <h3>Workflow Range</h3>
        <div>
          <label for="numHigh">Temp High: </label>
          <input type="number" id="numHigh" value="75" />
          <label for="numLow">Temp for Low: </label>
          <input type="number" id="numLow" value="65" />
        </div>
        <h3>Notification Settings</h3>
        <div>
          <label for="txtEmail">Email: </label>
          <input type="email" id="txtEmail" placeholder="first.last@domain.com" />
          <label for="numPhone">SMS: </label>
          <input type="tel" id="numPhone" placeholder="555-555-5555" />
        </div>
        <h3>Test Now</h3>
        <div>
          <label for="ip">IP: </label>
          <input type="text" id="ip" placeholder="10.10.100.10" />
          <input type="button" id="btnTest" value="Run Test" />
          <p id="testVal"></p>
        </div>
      </div>
<script>  
$("#btnTest").click(function (){
  var cTemp;
  $.getJSON("http://10.136.18.26:8484/pi/sensors/temperature",
    function(data){
      cTemp = (((data.value *9)/5) + 32).toFixed(2);
        hTemp = $('#numHigh').val(),
        lTemp = $('#numLow').val();
        $('#testVal').html(cTemp + " - " + hTemp + " - " + lTemp);
        console.log(cTemp + " - " + hTemp + " - " + lTemp);
    });
});
</script>
</body>

</html>